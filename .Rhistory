geom_text(
aes(label = round(correlation, 2), hjust = label_hjust),
color = "black",
size = 2,
fontface = "bold"
) +
coord_flip() +
labs(
title = "Correlation of FRED Variables with Log Total Loan Amount (LARS)",
x = "Variable",
y = "Correlation"
) +
theme_minimal(base_size = 16) +  # larger base text
theme(
plot.title = element_text(face = "bold", size = 14),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
axis.text.x  = element_text(size = 14),
axis.text.y  = element_text(size = 8),
panel.grid.minor = element_blank()
)
ggplot(corr_df, aes(x = reorder(variable_label, correlation),
y = correlation)) +
geom_col(fill = "#A5102D") +   # cranberry red
geom_text(
aes(label = round(correlation, 2), hjust = label_hjust),
color = "black",
size = 3,
fontface = "bold"
) +
coord_flip() +
labs(
title = "Correlation of FRED Variables with Log Total Loan Amount (LARS)",
x = "Variable",
y = "Correlation"
) +
theme_minimal(base_size = 16) +  # larger base text
theme(
plot.title = element_text(face = "bold", size = 14),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
axis.text.x  = element_text(size = 14),
axis.text.y  = element_text(size = 8),
panel.grid.minor = element_blank()
)
ggplot(corr_df, aes(x = reorder(variable_label, correlation),
y = correlation)) +
geom_col(fill = "#A5102D") +   # cranberry red
geom_text(
aes(label = round(correlation, 2), hjust = label_hjust),
color = "black",
size = 3,
fontface = "bold"
) +
coord_flip() +
scale_y_continuous(breaks = seq(0, 1, by = 0.2)) +
labs(
title = "Correlation of FRED Variables with Log Total Loan Amount (LARS)",
x = "Variable",
y = "Correlation"
) +
theme_minimal(base_size = 16) +  # larger base text
theme(
plot.title = element_text(face = "bold", size = 14),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
axis.text.x  = element_text(size = 12),
axis.text.y  = element_text(size = 8),
panel.grid.minor = element_blank()
)
ggplot(corr_df, aes(x = reorder(variable_label, correlation),
y = correlation)) +
geom_col(fill = "#A5102D") +   # cranberry red
geom_text(
aes(label = round(correlation, 2), hjust = label_hjust),
color = "black",
size = 3,
fontface = "bold"
) +
coord_flip() +
scale_y_continuous(breaks = seq(-0.4, 1, by = 0.2)) +
labs(
title = "Correlation of FRED Variables with Log Total Loan Amount (LARS)",
x = "Variable",
y = "Correlation"
) +
theme_minimal(base_size = 16) +  # larger base text
theme(
plot.title = element_text(face = "bold", size = 14),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
axis.text.x  = element_text(size = 12),
axis.text.y  = element_text(size = 8),
panel.grid.minor = element_blank()
)
library(ggrepel)
# List of log variables already renamed
log_vars <- c(
"log_equifax_subprime_q4",
"log_median_days_on_market",
"log_homeownership_rate_acs5",
"log_poverty_rate",
"log_mean_commute_time",
"log_crime_rate_fbitc",
"log_hs_grad_rate_acs5",
"log_snap_beneficiaries",
"log_population_county_thousands"
)
# Add your new variable
vars_for_corr <- c(log_vars, "log_loan_amount_percapita")
# Build correlation matrix
corr_matrix <- ds_1year %>%
select(all_of(vars_for_corr)) %>%
cor(use = "pairwise.complete.obs")
corr_matrix_rounded <- round(corr_matrix, 2)
corr_matrix_rounded
# 5) Barplot of correlations with log_loan_amount_percapita
corr_vec <- corr_matrix_rounded[, "log_loan_amount_percapita"]
corr_df <- data.frame(
variable = names(corr_vec),
correlation = as.numeric(corr_vec)
)
# Remove the loan variable itself
corr_df <- corr_df[corr_df$variable != "log_loan_amount_percapita", ]
# Sort by correlation (descending)
corr_df <- corr_df %>%
dplyr::arrange(dplyr::desc(correlation))
# Add labels
label_map <- c(
log_equifax_subprime_q4         = "Log Equifax Subprime Credit Data (Q4)",
log_median_days_on_market       = "Log Market Hotness: Median Days on Market (EOY M12)",
log_homeownership_rate_acs5     = "Log Homeownership Rate (5-year estimate)",
log_poverty_rate                = "Log % of People of All Ages in Poverty",
log_mean_commute_time           = "Log Mean Commuting Time for Workers",
log_crime_rate_fbitc            = "Log Violent & Property Crime Offenses Known",
log_hs_grad_rate_acs5           = "Log High School Graduate or Higher (5-year estimate)",
log_snap_beneficiaries          = "Log SNAP Benefits Recipients",
log_population_county_thousands = "Log County Population (Thousands)"
)
corr_df <- corr_df %>%
mutate(
variable_label = label_map[variable],
label_hjust    = ifelse(correlation > 0, 1.1, -0.1)
)
# Barplot
ggplot(corr_df, aes(x = reorder(variable_label, correlation),
y = correlation)) +
geom_col(fill = "#A5102D") +   # cranberry red
geom_text(
aes(label = round(correlation, 2), hjust = label_hjust),
color = "black",
size = 3,
fontface = "bold"
) +
coord_flip() +
scale_y_continuous(breaks = seq(-0.4, 1, by = 0.2)) +
labs(
title = "Correlation of FRED Variables with Log Total Loan Amount Per Capita (LARS)",
x = "Variable",
y = "Correlation"
) +
theme_minimal(base_size = 16) +  # larger base text
theme(
plot.title = element_text(face = "bold", size = 12),
axis.title.x = element_text(size = 12, face = "bold"),
axis.title.y = element_text(size = 12, face = "bold"),
axis.text.x  = element_text(size = 12),
axis.text.y  = element_text(size = 8),
panel.grid.minor = element_blank()
)
ggplot(ds_1year, aes(x = log_loan_amount_percapita, y = log_crime_rate_fbitc, color = as.factor(year))) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Scatterplot Loan Amount Per Capita and Violent & Crime \n Offensese Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal(base_size = 14)
View(ds_1year)
# Select numeric variables to log (exclude identifiers)
vars_to_log <- FREDLARTXLA %>%
dplyr::select(-county_code,-state,-year,-commute_time_bins) %>%
dplyr::select(where(is.numeric)) %>%
names()
# Create logged versions using log1p (log(1 + x))
FREDLARTXLA <- FREDLARTXLA %>%
dplyr::mutate(
dplyr::across(dplyr::all_of(vars_to_log), ~ log1p(.x), .names = "log_{.col}"))
FREDLARTXLA <- FREDLARTXLA %>%
dplyr::rename(
log_equifax_subprime_q4              = log_EQFXSUBPRIME,
log_median_days_on_market            = log_MEDAONMACOUNTY,
log_homeownership_rate_acs5          = log_HOWNRATEACS,
log_poverty_rate                     = log_PPAAWY,
log_mean_commute_time                = log_commute_time_mean,
log_crime_rate_fbitc                 = log_FBITC,
log_hs_grad_rate_acs5                = log_HC01ESTVC16,
log_snap_beneficiaries               = log_SNAPBR,
log_population_county_thousands      = log_POPULATION
)
#Plots
ggplot(FREDLARTXLA, aes(x = log_loan_amount_percapita, y = log_crime_rate_fbitc, color = as.factor(year))) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Scatterplot Loan Amount Per Capita and Violent & Crime \n Offensese Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal(base_size = 14)
View(iris)
View(FREDLARTXLA)
ds2021 <- FREDLARTXLA %>%
filter(year == 2021)
# Select numeric variables to log (exclude identifiers)
vars_to_log <- FREDLARTXLA %>%
dplyr::select(-county_code,-state,-year,-commute_time_bins) %>%
dplyr::select(where(is.numeric)) %>%
names()
# Create logged versions using log1p (log(1 + x))
FREDLARTXLA <- FREDLARTXLA %>%
dplyr::mutate(
dplyr::across(dplyr::all_of(vars_to_log), ~ log1p(.x), .names = "log_{.col}"))
FREDLARTXLA <- FREDLARTXLA %>%
dplyr::rename(
log_equifax_subprime_q4              = log_EQFXSUBPRIME,
log_median_days_on_market            = log_MEDAONMACOUNTY,
log_homeownership_rate_acs5          = log_HOWNRATEACS,
log_poverty_rate                     = log_PPAAWY,
log_mean_commute_time                = log_commute_time_mean,
log_crime_rate_fbitc                 = log_FBITC,
log_hs_grad_rate_acs5                = log_HC01ESTVC16,
log_snap_beneficiaries               = log_SNAPBR,
log_population_county_thousands      = log_POPULATION
)
FREDLARTXLA <- read_parquet("proc_data/FREDLARTXLA.parquet")
# Select numeric variables to log (exclude identifiers)
vars_to_log <- FREDLARTXLA %>%
dplyr::select(-county_code,-state,-year,-commute_time_bins) %>%
dplyr::select(where(is.numeric)) %>%
names()
# Create logged versions using log1p (log(1 + x))
FREDLARTXLA_l <- FREDLARTXLA %>%
dplyr::mutate(
dplyr::across(dplyr::all_of(vars_to_log), ~ log1p(.x), .names = "log_{.col}"))
FREDLARTXLA_l <- FREDLARTXLA_l %>%
dplyr::rename(
log_equifax_subprime_q4              = log_EQFXSUBPRIME,
log_median_days_on_market            = log_MEDAONMACOUNTY,
log_homeownership_rate_acs5          = log_HOWNRATEACS,
log_poverty_rate                     = log_PPAAWY,
log_mean_commute_time                = log_commute_time_mean,
log_crime_rate_fbitc                 = log_FBITC,
log_hs_grad_rate_acs5                = log_HC01ESTVC16,
log_snap_beneficiaries               = log_SNAPBR,
log_population_county_thousands      = log_POPULATION
)
log_vars <- c(
"log_equifax_subprime_q4",
"log_median_days_on_market",
"log_homeownership_rate_acs5",
"log_poverty_rate",
"log_mean_commute_time",
"log_crime_rate_fbitc",
"log_hs_grad_rate_acs5",
"log_snap_beneficiaries",
"log_population_county_thousands"
)
ggplot(FREDLARTXLA_l, aes(x = log_loan_amount_percapita, y = log_crime_rate_fbitc, color = as.factor(year))) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Scatterplot Loan Amount Per Capita and Violent & Crime \n Offensese Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal(base_size = 14)
ggplot(FREDLARTXLA_l, aes(x = log_loan_amount_percapita, y = log_crime_rate_fbitc)) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Scatterplot Loan Amount Per Capita and Violent & Crime \n Offensese Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal(base_size = 14)
ggplot(FREDLARTXLA_l, aes(x = log_loan_amount_percapita, y = log_crime_rate_fbitc, color = as.factor(year))) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Scatterplot Loan Amount Per Capita and Violent & Crime \n Offensese Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal()
summary(FREDLARTXLA_l)
ggplot(FREDLARTXLA_l, aes(x = log_loan_amount_percapita, y = log_crime_rate_fbitc, color = as.factor(year))) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE) +
labs(
title = "Scatterplot Loan Amount Per Capita and \n Log of People of All Ages in Poverty",
x = "Log of People of All Ages in Poverty",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal(base_size = 14)
FRED_clean <- FREDLARTXLA_l %>%
filter(
!is.na(log_loan_amount_percapita),
!is.na(log_crime_rate_fbitc),
log_loan_amount_percapita > 0,
log_crime_rate_fbitc > 0
)
ggplot(
FRED_clean,
aes(x = log_crime_rate_fbitc,
y = log_loan_amount_percapita,
color = as.factor(year))
) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
labs(
title = "Scatterplot of Loan Amount Per Capita and Violent & Property Crime Offenses Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "right"
)
ggplot(
FRED_clean,
aes(x = log_crime_rate_fbitc,
y = log_loan_amount_percapita,
color = as.factor(year))
) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
labs(
title = "Scatterplot of Loan Amount Per Capita and \nViolent & Property Crime Offenses Known",
x = "Log Violent & Property Crime Offenses Known",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "right"
)
FRED_clean2 <- FREDLARTXLA_l %>%
filter(
!is.na(log_loan_amount_percapita),
!is.na(log_crime_rate_fbitc),
log_loan_amount_percapita > 0,
log_crime_rate_fbitc > 0
)
ggplot(
FRED_clean2,
aes(
x = log_crime_rate_fbitc,
y = log_loan_amount_percapita,
color = as.factor(year)
)
) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
labs(
title = "Scatterplot Loan Amount Per Capita and \nLog of People of All Ages in Poverty",
x = "Log of People of All Ages in Poverty",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "right"
)
FRED_clean2 <- FREDLARTXLA_l %>%
filter(
!is.na(log_loan_amount_percapita),
!is.na(log_poverty_rate),
log_loan_amount_percapita > 0,
log_poverty_rate > 0
)
ggplot(
FRED_clean2,
aes(
x = log_poverty_rate,
y = log_loan_amount_percapita,
color = as.factor(year)
)
) +
geom_point(alpha = 0.7) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
labs(
title = "Scatterplot Loan Amount Per Capita and \nLog of People of All Ages in Poverty",
x = "Log of People of All Ages in Poverty",
y = "Log Total Loan Amount Per Capita",
color = "Year"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "right"
)
outliers <- fred_data_binned %>%
group_by(home_bin, year) %>%
mutate(
Q1 = quantile(EQFXSUBPRIME, 0.25, na.rm = TRUE),
Q3 = quantile(EQFXSUBPRIME, 0.75, na.rm = TRUE),
IQR = Q3 - Q1,
lower = Q1 - 1.5 * IQR,
upper = Q3 + 1.5 * IQR
) %>%
filter(EQFXSUBPRIME < lower | EQFXSUBPRIME > upper) %>%
ungroup
#Box Plot, outliers labeled by county code
ggplot(fred_data_binned, aes(x = interaction(home_bin, year), y = EQFXSUBPRIME, fill = as.factor(year))) +
geom_boxplot(outlier.color = "red", outlier.alpha = 0.7) +
geom_text_repel(
data = outliers,
aes(x = interaction(home_bin, year),
y = EQFXSUBPRIME,
label = county_code),
color = "black",
size = 3,
max.overlaps = Inf,
box.padding = 0.4,
point.padding = 0.3,
min.segment.length = 0
) +
labs(
title = "Distribution of Subprime Mortgages by Home Ownership",
x = "Home Ownership Bin + Year",
y = "Subprime Mortgage Rate",
fill = "Year" ) +
theme_minimal(base_size = 16) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(fred_data_binned, aes(x = interaction(home_bin, year), y = EQFXSUBPRIME, fill = as.factor(year))) +
geom_violin(trim = FALSE, alpha = 0.7) +
geom_point(
data = outliers,
aes(x = interaction(home_bin, year),
y = EQFXSUBPRIME),
color = "red",
alpha = 0.7,
size = 2 ) +
geom_text_repel(
data = outliers,
aes(x = interaction(home_bin, year),
y = EQFXSUBPRIME,
label = county_code),
color = "black",
size = 3,
max.overlaps = Inf,
box.padding = 0.4,
point.padding = 0.3,
min.segment.length = 0) +
labs(
title = "Distribution of Subprime Mortgages by Home Ownership (Violin Plot)",
x = "Home Ownership Bin + Year",
y = "Subprime Mortgage Rate",
fill = "Year"
) +
theme_minimal(base_size = 16) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
tab_6d <- table(
action_taken   = g3lar$action_taken,
occupancy_type = g3lar$occupancy_type,
useNA = "ifany"
)
# Fix any empty or NA column names so every column has a valid name
cn <- colnames(tab_6d)
cn[cn == "" | is.na(cn)] <- "Missing / blank"
colnames(tab_6d) <- cn
# Convert to data frame for kable, manually add action_taken as a column
tab_6d_df_mat <- as.data.frame.matrix(tab_6d)
table_6d_df <- data.frame(
action_taken = rownames(tab_6d_df_mat),
tab_6d_df_mat,
row.names = NULL,
check.names = FALSE
)
kable(
table_6d_df,
format = "markdown",
caption = "Cross-Tabulation of Action Taken by Occupancy Type (Counts Only)"
) %>%
kable_styling(full_width = FALSE)
# 2. Percentage of data in "Not Applicable" action_taken
percent_not_applicable <- mean(g3lar$action_taken == "Not Applicable", na.rm = TRUE)
percent_not_applicable          # as a proportion
percent_not_applicable * 100    # as a percentage
# 3. Graph: grouped bar chart for the two-way table
ggplot(g3lar, aes(x = action_taken, fill = occupancy_type)) +
geom_bar(position = "dodge") +
labs(
title = "Action Taken on Loan by Occupancy Type",
x = "Action Taken",
y = "Count",
fill = "Occupancy Type"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
