expand = expansion(mult = c(0, 0.12))
) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
labs(
title   = "Action Taken — Second Residence",
x       = "Action Taken",
y       = "Count",
caption = "Note: Counts reflect the number of applications by action taken for second residences."
) +
theme_minimal(base_size = 14) +
theme(
plot.title   = element_text(face = "bold", size = 20),
plot.caption = element_text(size = 10, hjust = 0, margin = margin(t = 10)),
axis.text.x  = element_text(angle = 0, hjust = 0.5, vjust = 1),
axis.title.x = element_text(margin = margin(t = 10)),
axis.title.y = element_text(margin = margin(r = 10)),
panel.grid.major.x = element_blank(),
panel.grid.minor   = element_blank()
)
## 3. Investment property
ggplot(
investment_data,
aes(x = action_taken, y = n)
) +
geom_col(
fill = occ_colors["Investment property"],
width = 0.6
) +
geom_text(
aes(label = comma(n)),
vjust = -0.25,
size = 2.5,
color = "black"
) +
scale_y_continuous(
labels = comma,
expand = expansion(mult = c(0, 0.12))
) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
labs(
title   = "Action Taken — Investment Property",
x       = "Action Taken",
y       = "Count",
caption = "Note: Counts reflect the number of applications by action taken for investment properties."
) +
theme_minimal(base_size = 14) +
theme(
plot.title   = element_text(face = "bold", size = 20),
plot.caption = element_text(size = 10, hjust = 0, margin = margin(t = 10)),
axis.text.x  = element_text(angle = 0, hjust = 0.5, vjust = 1),
axis.title.x = element_text(margin = margin(t = 10)),
axis.title.y = element_text(margin = margin(r = 10)),
panel.grid.major.x = element_blank(),
panel.grid.minor   = element_blank()
)
ggplot(
principal_data,
aes(x = action_taken, y = n)
) +
geom_col(
fill = occ_colors["Principal residence"],
width = 0.6
) +
geom_text(
aes(label = comma(n)),
vjust = -0.25,
size = 2.5,
color = "black"
) +
scale_y_continuous(
labels = comma,
expand = expansion(mult = c(0, 0.12))
) +
scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
labs(
title   = "Action Taken — Principal Residence",
x       = "Action Taken",
y       = "Count",
caption = "Note: Counts reflect the number of applications by action taken for principal residences."
) +
theme_minimal(base_size = 14) +
theme(
plot.title   = element_text(face = "bold", size = 20),
plot.caption = element_text(size = 10, hjust = 0, margin = margin(t = 10)),
axis.text.x  = element_text(angle = 0, hjust = 0.5, vjust = 1),
axis.title.x = element_text(margin = margin(t = 10)),
axis.title.y = element_text(margin = margin(r = 10)),
panel.grid.major.x = element_blank(),
panel.grid.minor   = element_blank()
)
FREDLARTXLA <- read_parquet("proc_data/FREDLARTXLA.parquet")
FREDLARTXLA <- read_parquet("../proc_data/FREDLARTXLA.parquet")
FREDLARTXLA <- read_parquet("./proc_data/FREDLARTXLA.parquet")
palette_colors <- c("#E64B35", "#4DBBD5", "#00A087", "#3C5488")
# Select only records with valid MEDAONMACOUNTY values
q18a_data <- FREDLARTXLA %>%
filter(!is.na(MEDAONMACOUNTY))
# Pre-calc mean and sd
mean_val <- mean(q18a_data$MEDAONMACOUNTY, na.rm = TRUE)
sd_val   <- sd(q18a_data$MEDAONMACOUNTY, na.rm = TRUE)
plot_hist <- ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram (60% transparency)
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "black"
) +
# Density curve
geom_density(
aes(color = "Density curve"),
size = 1.2
) +
# Normal distribution overlay
stat_function(
aes(linetype = "Normal distribution"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
size = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "Legend",
color = "Legend",
linetype = "Legend"
) +
# Apply your palette
scale_fill_manual(values = c("Histogram" = palette_colors[1])) +
scale_color_manual(values = c("Density curve" = palette_colors[2])) +
scale_linetype_manual(values = c("Normal distribution" = "dashed")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
plot_hist
# Select only records with valid MEDAONMACOUNTY values
q18a_data <- FREDLARTXLA %>%
filter(!is.na(MEDAONMACOUNTY))
# Pre-calc mean and sd
mean_val <- mean(q18a_data$MEDAONMACOUNTY, na.rm = TRUE)
sd_val   <- sd(q18a_data$MEDAONMACOUNTY, na.rm = TRUE)
plot_hist <- ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram with thin border and border = fill color, 60% transparency
geom_histogram(
aes(y = ..density.., fill = "Histogram", color = "Histogram"),
bins = 30,
alpha = 0.6,
linewidth = 0.2
) +
# Density curve
geom_density(
aes(color = "Density curve"),
size = 1.2
) +
# Normal distribution overlay
stat_function(
aes(linetype = "Normal distribution"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = palette_colors[3],
size  = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "Legend",
color = "Legend",
linetype = "Legend"
) +
# Apply your palette
scale_fill_manual(values = c("Histogram" = palette_colors[1])) +
scale_color_manual(values = c(
"Histogram" = palette_colors[1],
"Density curve" = palette_colors[2]
)) +
scale_linetype_manual(values = c("Normal distribution" = "dashed")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
plot_hist
palette_colors <- c("#E64B35", "#4DBBD5", "#00A087", "#3C5488")
# Select only records with valid MEDAONMACOUNTY values
q18a_data <- FREDLARTXLA %>%
filter(!is.na(MEDAONMACOUNTY))
# Pre-calc mean and sd
mean_val <- mean(q18a_data$MEDAONMACOUNTY, na.rm = TRUE)
sd_val   <- sd(q18a_data$MEDAONMACOUNTY, na.rm = TRUE)
plot_hist <- ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram with border = fill color and 60% transparency
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = palette_colors[1],  # border matches fill
linewidth = 0.2
) +
# Density curve
geom_density(
aes(color = "Density curve"),
size = 1.2
) +
# Normal distribution overlay
stat_function(
aes(linetype = "Normal distribution"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = palette_colors[3],
size  = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "Legend",
color = "Legend",
linetype = "Legend"
) +
# Apply palette colors
scale_fill_manual(values = c("Histogram" = palette_colors[1])) +
scale_color_manual(values = c("Density curve" = palette_colors[2])) +
scale_linetype_manual(values = c("Normal distribution" = "dashed")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
plot_hist
plot_hist <- ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram: filled orange box
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "orange",     # border matches fill
fill  = "orange",
linewidth = 0.2
) +
# Density: blue line
geom_density(
aes(color = "Density"),
size = 1.2,
color = "blue"
) +
# Normal distribution: dotted green line
stat_function(
aes(linetype = "Normal"),
fun  = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "green",
size  = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "Legend",
color = "Legend",
linetype = "Legend"
) +
# Legend values
scale_fill_manual(values = c("Histogram" = "orange")) +
scale_color_manual(values = c("Density" = "blue")) +
scale_linetype_manual(values = c("Normal" = "dotted")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
plot_hist
plot_hist <- ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "#4DBBD5",   # border matches fill
fill  = "#4DBBD5",
linewidth = 0.2
) +
# Density curve
geom_density(
aes(color = "Density"),
size = 1.2,
color = "#00A087"
) +
# Normal distribution curve
stat_function(
aes(linetype = "Normal"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "#E64B35",
size = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "Legend",
color = "Legend",
linetype = "Legend"
) +
scale_fill_manual(values = c("Histogram" = "#4DBBD5")) +
scale_color_manual(values = c("Density" = "#00A087")) +
scale_linetype_manual(values = c("Normal" = "dotted")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
plot_hist
ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "#4DBBD5",   # border matches fill
fill  = "#4DBBD5",
linewidth = 0.2
) +
# Density curve
geom_density(
aes(color = "Density"),
size = 1.2,
color = "#00A087"
) +
# Normal distribution curve
stat_function(
aes(linetype = "Normal"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "#E64B35",
size = 2
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "",
color = "",
linetype = ""
) +
scale_fill_manual(values = c("Histogram" = "#4DBBD5")) +
scale_color_manual(values = c("Density" = "#00A087")) +
scale_linetype_manual(values = c("Normal" = "dotted")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "#4DBBD5",
fill  = "#4DBBD5",
linewidth = 0.2
) +
# Density curve
geom_density(
aes(color = "Density"),
size = 1.2,
color = "#00A087"
) +
# Normal distribution curve
stat_function(
aes(linetype = "Normal"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "#E64B35",
size = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "",
color = "",
linetype = ""
) +
scale_fill_manual(values = c("Histogram" = "#4DBBD5")) +
scale_color_manual(values = c("Density" = "#00A087")) +
scale_linetype_manual(values = c("Normal" = "dashed")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "#4DBBD5",
linewidth = 0.2
) +
# Density curve (map color so it enters legend)
geom_density(
aes(color = "Density"),
size = 1.2
) +
# Normal distribution curve
stat_function(
aes(linetype = "Normal"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
size = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "",
color = "",
linetype = ""
) +
# Legend colors
scale_fill_manual(values = c("Histogram" = "#4DBBD5")) +
scale_color_manual(values = c("Density" = "#00A087")) +
scale_linetype_manual(values = c("Normal" = "dashed")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12)
)
ggplot(q18a_data, aes(x = MEDAONMACOUNTY)) +
# Histogram
geom_histogram(
aes(y = ..density.., fill = "Histogram"),
bins = 30,
alpha = 0.6,
color = "#4DBBD5",
fill  = "#4DBBD5",
linewidth = 0.2
) +
# Density curve
geom_density(
aes(color = "Density"),
size = 1.2,
color = "#00A087"
) +
# Normal distribution curve
stat_function(
aes(linetype = "Normal"),
fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "#E64B35",
size = 1
) +
facet_grid(state ~ year) +
labs(
title = "Distribution of Median Days on Market by State and Year",
subtitle = "Histogram with Density Curve and Normal Distribution Overlay",
x = "Median Days on Market",
y = "Density",
fill = "",
color = "",
linetype = ""
) +
scale_fill_manual(values = c("Histogram" = "#4DBBD5")) +
scale_color_manual(values = c("Density" = "#00A087")) +
scale_linetype_manual(values = c("Normal" = "dashed")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
strip.text = element_text(face = "bold", size = 11),
plot.title = element_text(face = "bold", size = 15),
plot.subtitle = element_text(size = 12),
legend.key.width = unit(2, "cm")
)
unlink("code/master_code_cache", recursive = TRUE)
